app:
  name: media-stack
  project: media
  source:
    repoURL: git@github.com:pale-whale/infra
    targetRevision: HEAD
    path: k8s/charts/media-stack
  destination:
    server: https://kubernetes.default.svc
    namespace: media
  helm:
    values: |
      global:
        ingress:
          enabled: true
          annotations:
            traefik.ingress.kubernetes.io/router.middlewares: traefik-traefik-forward-auth@kubernetescrd
            traefik.ingress.kubernetes.io/router.tls: 'true'
          backends:
            transmission:
              enabled: true
              host: transmission.palewhale.fr
            prowlarr:
              enabled: true
              host: prowlarr.palewhale.fr
      mediaPVC:
        storageClassName: ceph-filesystem
        size: 2000Gi
      transmission:
        image:
          tag: 5.3.1
        user:
          uid: 1000
          gid: 1000
        extraEnv:
        - name: TRANSMISSION_INCOMPLETE_DIR
          value: '/downloads/incomplete'
        provider:
          name: PIA
          localNetwork: '10.0.0.0/8,172.16.0.0/16'
          create_tun_device: 'false'
          endpoint: france
          user:
            externalSecret:
              secretStoreRef:
                kind: ClusterSecretStore
                name: infisical
              secret:
                userKey: /transmission-vpn/username
                passKey: /transmission-vpn/password
        rpc:
          enabled: true
          auth_required: true
          user:
            externalSecret:
              secretStoreRef:
                kind: ClusterSecretStore
                name: infisical
              secret:
                userKey: /transmission-rpc/username
                passKey: /transmission-rpc/password

        persistence:
          config:
            enabled: true
            storageClassName: block
            size: 500Mi
          downloads:
            enabled: true
            storageClassName: filesystem
            accessModes:
              - ReadWriteMany
            size: 1500Gi

